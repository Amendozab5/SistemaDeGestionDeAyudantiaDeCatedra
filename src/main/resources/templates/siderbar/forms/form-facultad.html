<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<div th:fragment="content">
    <div class="container mx-auto px-4 sm:px-8">
        <div class="py-8">
            <div class="flex justify-between items-center">
                <h2 class="text-2xl font-semibold leading-tight">Gestión de Facultades</h2>
                <button id="open-facultad-modal-btn" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">
                    <i class="fas fa-plus"></i> Crear Nueva Facultad
                </button>
            </div>

            <div class="-mx-4 sm:-mx-8 px-4 sm:px-8 py-4 overflow-x-auto">
                <div class="inline-block min-w-full shadow-md rounded-lg overflow-hidden">
                    <table class="min-w-full leading-normal">
                        <thead>
                        <tr>
                            <th
                                    class="px-5 py-3 border-b-2 border-gray-200 bg-gray-800 text-left text-xs font-semibold text-gray-300 uppercase tracking-wider">
                                ID
                            </th>
                            <th
                                    class="px-5 py-3 border-b-2 border-gray-200 bg-gray-800 text-left text-xs font-semibold text-gray-300 uppercase tracking-wider">
                                Nombre de la Facultad
                            </th>
                            <th
                                    class="px-5 py-3 border-b-2 border-gray-200 bg-gray-800 text-center text-xs font-semibold text-gray-300 uppercase tracking-wider">
                                Acciones
                            </th>
                        </tr>
                        </thead>
                        <tbody id="facultad-table-body">
                        <tr th:each="facultad : ${facultades}">
                            <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">
                                <p class="text-gray-900 whitespace-no-wrap" th:text="${facultad.id}"></p>
                            </td>
                            <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">
                                <p class="text-gray-900 whitespace-no-wrap" th:text="${facultad.nombre}"></p>
                            </td>
                            <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm text-center">
                                <button class="text-yellow-500 hover:text-yellow-700 mr-3 btn-editar-facultad" th:attr="data-id=${facultad.id}">
                                    <i class="fas fa-pencil-alt"></i>
                                </button>
                                <button class="text-red-500 hover:text-red-700 btn-eliminar-facultad" th:attr="data-id=${facultad.id}">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <script>
        (function() {
            const tableBody = document.getElementById('facultad-table-body');
            const genericModal = document.getElementById('generic-modal');
            const genericModalContent = document.getElementById('generic-modal-content');

            if (tableBody) {
                tableBody.addEventListener('click', async (e) => {
                    const deleteButton = e.target.closest('.btn-eliminar-facultad');
                    const editButton = e.target.closest('.btn-editar-facultad');

                    if (deleteButton) {
                        const facultadId = deleteButton.dataset.id;
                        window.showConfirmationModal(`¿Estás seguro de que deseas eliminar la facultad con ID ${facultadId}?`, async () => {
                            try {
                                const response = await fetch(`/gestionacademica/facultad/eliminar/${facultadId}`, {
                                    method: 'DELETE',
                                });
                                if (response.ok) {
                                    window.showAlertModal('Facultad eliminada correctamente.');
                                    // Reload the view
                                    document.getElementById('load-gestion-academica-sidebar').click();
                                } else {
                                    window.showAlertModal('Error al eliminar la facultad.');
                                }
                            } catch (error) {
                                console.error('Error:', error);
                                window.showAlertModal('Ocurrió un error al eliminar la facultad.');
                            }
                        });
                    }

                    if (editButton) {
                        const facultadId = editButton.dataset.id;
                        try {
                            const response = await fetch(`/gestionacademica/facultad/editar/${facultadId}`);
                            if (response.ok) {
                                genericModalContent.innerHTML = await response.text();
                                genericModal.classList.remove('hidden');
                                genericModal.classList.add('flex');
                            } else {
                                window.showAlertModal('Error al cargar el formulario de edición.');
                            }
                        } catch (error) {
                            console.error('Error:', error);
                            window.showAlertModal('Ocurrió un error al cargar el formulario de edición.');
                        }
                    }
                });
            }

            if (genericModal) {
                genericModal.addEventListener('click', (e) => {
                    if (e.target === genericModal) {
                        genericModal.classList.add('hidden');
                        genericModal.classList.remove('flex');
                    }
                });
            }
        })();
    </script>
</div>
</body>
</html>