<div th:fragment="content">
    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <h1 class="text-3xl font-bold text-gray-800 mb-6">Registro de Asistencia</h1>

        <form th:action="@{/estudiante/asistencia/guardar}" th:object="${asistenciaForm}" method="post" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">

            <div class="flex flex-wrap -mx-3 mb-6">
                <div class="w-full md:w-1/2 px-3 mb-6 md:mb-0">
                    <label class="block uppercase tracking-wide text-gray-700 text-xs font-bold mb-2" for="asignatura-select">
                        Asignatura
                    </label>
                    <select id="asignatura-select" th:field="*{idAsignatura}" class="block appearance-none w-full bg-gray-200 border border-gray-200 text-gray-700 py-3 px-4 pr-8 rounded leading-tight focus:outline-none focus:bg-white focus:border-gray-500">
                        <option th:each="asignatura : ${asignaturas}" th:value="${asignatura.idAsignatura}" th:text="${asignatura.nombre}"></option>
                    </select>
                </div>
                <div class="w-full md:w-1/2 px-3">
                    <label class="block uppercase tracking-wide text-gray-700 text-xs font-bold mb-2" for="fecha-sesion">
                        Fecha y Hora de la Sesi√≥n
                    </label>
                    <input id="fecha-sesion" type="datetime-local" th:field="*{fechaSesion}" class="block w-full bg-gray-200 text-gray-700 border border-gray-200 rounded py-3 px-4 leading-tight focus:outline-none focus:bg-white focus:border-gray-500" required>
                </div>
            </div>

            <div class="mt-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">Lista de Estudiantes</h2>
                <div class="overflow-x-auto">
                    <table class="min-w-full bg-white">
                        <thead class="bg-gray-800 text-white">
                            <tr>
                                <th class="text-left py-3 px-4 uppercase font-semibold text-sm">Estudiante</th>
                                <th class="text-center py-3 px-4 uppercase font-semibold text-sm">Asistencia</th>
                                <th class="text-left py-3 px-4 uppercase font-semibold text-sm">Observaciones</th>
                            </tr>
                        </thead>
                        <tbody id="student-list-body" class="text-gray-700">
                            <tr th:each="estudiante, iterStat : ${estudiantes}">
                                <td class="text-left py-3 px-4" th:text="${estudiante.usuario.nombres} + ' ' + ${estudiante.usuario.apellidos}"></td>
                                <td class="text-center py-3 px-4">
                                    <input type="hidden" th:name="|asistencias[${iterStat.index}].idEstudiante|" th:value="${estudiante.idEstudiante}" />
                                    <div class="flex justify-center space-x-4">
                                        <label class="inline-flex items-center">
                                            <input type="radio" th:name="|asistencias[${iterStat.index}].estado|" value="PRESENTE" class="form-radio h-5 w-5 text-green-600" checked><span class="ml-2">Presente</span>
                                        </label>
                                        <label class="inline-flex items-center">
                                            <input type="radio" th:name="|asistencias[${iterStat.index}].estado|" value="AUSENTE" class="form-radio h-5 w-5 text-red-600"><span class="ml-2">Ausente</span>
                                        </label>
                                        <label class="inline-flex items-center">
                                            <input type="radio" th:name="|asistencias[${iterStat.index}].estado|" value="JUSTIFICADO" class="form-radio h-5 w-5 text-yellow-600"><span class="ml-2">Justificado</span>
                                        </label>
                                    </div>
                                </td>
                                <td class="text-left py-3 px-4">
                                    <input type="text" th:name="|asistencias[${iterStat.index}].observaciones|" class="w-full px-2 py-1 border rounded">
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="flex items-center justify-end mt-6">
                <button type="submit" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
                    Guardar Asistencia
                </button>
            </div>

        </form>
    </div>

    <script>
        document.getElementById('asignatura-select').addEventListener('change', function() {
            const asignaturaId = this.value;
            const studentListBody = document.getElementById('student-list-body');

            fetch(`/estudiante/estudiantesPorAsignatura?asignaturaId=${asignaturaId}`)
                .then(response => response.json())
                .then(data => {
                    studentListBody.innerHTML = ''; // Limpiar la lista actual
                    data.forEach((estudiante, index) => {
                        const row = `
                            <tr>
                                <td class="text-left py-3 px-4">${estudiante.usuario.nombres} ${estudiante.usuario.apellidos}</td>
                                <td class="text-center py-3 px-4">
                                    <input type="hidden" name="asistencias[${index}].idEstudiante" value="${estudiante.idEstudiante}" />
                                    <div class="flex justify-center space-x-4">
                                        <label class="inline-flex items-center">
                                            <input type="radio" name="asistencias[${index}].estado" value="PRESENTE" class="form-radio h-5 w-5 text-green-600" checked><span class="ml-2">Presente</span>
                                        </label>
                                        <label class="inline-flex items-center">
                                            <input type="radio" name="asistencias[${index}].estado" value="AUSENTE" class="form-radio h-5 w-5 text-red-600"><span class="ml-2">Ausente</span>
                                        </label>
                                        <label class="inline-flex items-center">
                                            <input type="radio" name="asistencias[${index}].estado" value="JUSTIFICADO" class="form-radio h-5 w-5 text-yellow-600"><span class="ml-2">Justificado</span>
                                        </label>
                                    </div>
                                </td>
                                <td class="text-left py-3 px-4">
                                    <input type="text" name="asistencias[${index}].observaciones" class="w-full px-2 py-1 border rounded">
                                </td>
                            </tr>
                        `;
                        studentListBody.innerHTML += row;
                    });
                });
        });
    </script>

</div>